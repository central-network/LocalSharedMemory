<meta charset="utf8" />
<script type="module">
    import LocalSharedMemory from "./LocalSharedMemory.js"
    self.memory = new LocalSharedMemory()

    console.warn(memory)
    console.warn(memory.malloc(24))
    console.warn(memory.malloc(5, 2))
    console.warn(memory.sizeof(memory.malloc(1, 0)))
    console.warn(memory.malloc(7, 0))
    console.table(memory.allocs())

    const worker = new Worker(URL.createObjectURL(new Blob([`
    ${LocalSharedMemory}
    onmessage = e => {
        self.memory = e.data;
        Reflect.setPrototypeOf(memory, LocalSharedMemory.prototype)
        console.warn(memory)
        console.warn(memory.allocs())
    }
    `])))

    requestIdleCallback(() => {
        worker.postMessage(memory)
    })
</script>